
<!doctype html>
<html style="font-size: 52.0833px;">

<head style="box-sizing: border-box;">
  <meta charset="utf-8" />
  <title>小绿篮发单登录</title>
  <meta name="viewport" content="width=360,maximum-scale=1.1,user-scalable=no">
  <meta http-equiv="cache-control" content="no-cache" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta content="telephone=no" name="format-detection" />
  <!--    <script src="--><!--js/jquery-1.9.1.min.js"></script>-->

  <link rel="stylesheet" href="css/weui.min.css">
  <link rel="stylesheet" href="css/jquery-weui.min.css">
  <link rel="stylesheet" href="css/common.css">
  <style>
    .bg{background:#000;opacity:0.6;width:100%;height:100%;min-height:100%;position:fixed;z-index:1000;top:0;left:0;right:0;bottom:0;}
    .tippic{position:fixed;top:0;right:20px;z-index:1200;}
    #knowbtn button{background:#fff;color:#000000;font-size:13px;border-radius:6px;width:50%;height:35px;margin:0 auto;position:fixed;bottom:20%;left:50%;margin-left:-25%;z-index:1200}
  </style>
</head>

<body style="font-family: microsoftyahei; font-size: 20px; margin: auto; min-height: 100%; background-color: #ffffff; max-width: 100%;">

<div id="container" class="container">
  <div class="head" style="margin-bottom: 10px">
    <img src="img/xiaolvlanbanner.png" alt="" style="pointer-events: none;">
  </div>
  <input type="hidden" id="mark" value="" />
  <input type="hidden" id="num" value="1" />
  <div class="page">
    <div class="page__bd page__bd_spacing">
      <div class="form">
        <form action="">
          <div class="weui-flex">
            <div class="weui-flex__item phoneitem" >
              <p><input type="text" id="username" class="myinput phone" placeholder="请输入手机号" /></p>
            </div>
          </div>
          <div class="weui-flex">
            <div class="weui-flex__item yzcode1"><p><input type="text" class="myinput msgyz" placeholder="请输入验证码" /></p></div>
            <div class="" style="margin-left: 12px;"><button type="button" onclick="getsms($(this))" class="weui-btn mybtn yzmbtn">获取验证码</button></div>
          </div>
          <div class="weui-flex">
            <div class="weui-flex__item">
              <button type="button" class="weui-btn mybtn toOpen" id="loginBtn">登录</button>
            </div>
          </div>
        </form>

      </div>

    </div>
  </div>


</div>
<div id="tips" style="display: none;">
  <div class="bg"></div>
  <div class="tippic"><img src="http://static.99byh.com/static/pdd2/yunbill/v1/img/tippic.png" alt="" style="width: 200px;"></div>
  <!-- <div id="knowbtn" style=""><button type="button">知道了</button></div> -->
</div>

<div class="weui-toast weui-toast--text " style="display: none;opacity: 1;background:rgba(0,0,0,0.5);visibility: visible"><i class=" weui-icon_toast"></i><p class="weui-toast_content toastxt" style="visibility: visible"></p></div>
<script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="js/jquery-weui.min.js" type="text/javascript"></script>
<script type="text/javascript">
  //微信官方js判断是否在微信中打开页面
  var ua = navigator.userAgent.toLowerCase();
  var isWeixin = ua.indexOf('micromessenger') != -1;
  if (isWeixin) {
    //如果在微信中打开，提示请在浏览器打开
    $('#tips').show();
  }

  //点击获取验证码按钮，开始倒计时



  var countdown=60;


  function myToast(text){
    $('.weui-toast').show();
    $('.toastxt').text(text);
    setTimeout(function(){
      $('.weui-toast').hide();
    },2000);
  }


  function getsms(obj){
    var reg = /^1\d{10}$/;
    var num=$('#num').val();
    $('#num').val(2);
    if($('#username').val() == '') {
      myToast("请输入手机号");
      //$.toast("请输入手机号", "text");
      return false;
    }
    if(!reg.test($('#username').val())) {
      myToast("手机号不正确");
      //$.toast("手机号不正确", "text");
      return false;
    }

    $.ajax({
      type : "get",
      dataType : "json",
      async:false,
      url : "http://47.96.183.68:8088/app/login/sendCheckCode",

      data:{
        phone:$('#username').val(),
        num:num
      },

      success : function(data){
        console.log(data.code);
        if(data.success==true){
          myToast("短信验证码已发送");
          // $.toast("短信验证码已发送", "text");

          $('#mark').val(data.data);

          settime(obj);
        }else if(data.success==false){
          myToast(data.message);
        }else{
          myToast(data.message);
          // $.toast(data.msg, "text");
        }
      }
    })

  }


  function settime(obj) {

    if (countdown == 0) {
      obj.removeAttr("disabled");
      obj.html("重新发送");
      countdown = 60;
      obj.css('background','#0000ff');
      return;
    } else {
      obj.attr("disabled", true);
      obj.html("重新发送(" + countdown + ")");
      obj.css('background','#6C6D69');
      countdown--;
    }
    setTimeout(function() { settime(obj) },1000)
  }

  $(function(){

    var reg = /^1\d{10}$/;
    $('#loginBtn').on('click', function() {
      if($('#username').val() == '') {
        //$.toast("请输入手机号", "text");
        myToast("请输入手机号");
        // $.toast("请输入手机号", "text");
        return false;
      }
      if(!reg.test($('#username').val())) {
        myToast("手机号不正确");
        //  $.toast("手机号不正确", "text");
        return false;
      }

      if($('.msgyz').val() == '') {
        myToast("请输入短信验证码");
        // $.toast("请输入短信验证码", "text");
        return false;
      }

      $.ajax({
        type : "post",
        dataType : "json",
        async:false,
        url : "http://apitest.walongkeji.com/app/login",

        data:{
          phone:$('#username').val(),
          checkCode :$('.msgyz').val(),
          mark:$('#mark').val()
        },

        success : function(data){
          console.log(data.code);
          if(data.success==true){
            sessionStorage.setItem("userId", data.data.userId);
            //注册成功
            window.location.href = 'main.html';

            // window.location.href = 'success.html';
          }else{
            myToast(data.message);
            // $.toast(data.msg, "text");
          }
        }
      })



    })




  })
</script>

</body>

</html>
